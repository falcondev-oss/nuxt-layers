name: ðŸš¥ CI/CD

on:
  workflow_dispatch:
  push:
    branches: ['**']

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  lint:
    name: ðŸ’… Lint
    runs-on: ubuntu-latest
    strategy:
      matrix:
        layer: [base]
    defaults:
      run:
        working-directory: ${{ matrix.layer }}
    steps:
      - name: pnpm install
        uses: falcondev-it/.github/actions/pnpm-install@master

      - name: Cache ESLint & Prettier
        uses: actions/cache@v4
        with:
          path: |
            ${{ matrix.layer }}/.eslintcache
            ${{ matrix.layer }}/node_modules/.cache/prettier/.prettier-cache
          key: eslint-prettier-cache-${{ matrix.layer }}-${{ runner.os }}

      - run: pnpm nuxt prepare
      - run: pnpm run lint

  type-check:
    name: ðŸ›ƒ Type Check
    runs-on: ubuntu-latest
    strategy:
      matrix:
        layer: [base]
    defaults:
      run:
        working-directory: ${{ matrix.layer }}
    steps:
      - name: pnpm install
        uses: falcondev-it/.github/actions/pnpm-install@master

      - run: pnpm nuxt prepare
      - run: pnpm run type-check
